<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FERRAMENTARIA 4.0</title>
<style>
* {margin:0;padding:0;box-sizing:border-box;}
body {
    font-family:-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: linear-gradient(135deg, #0b2a2e 0%, #064643 100%);
    height:100vh;
    overflow:hidden;
    color:#fff;
}
.chat-container {
    display:flex;
    flex-direction:column;
    height:100vh;
    max-width:1200px;
    margin:0 auto;
    background: rgba(11,42,46,0.95);
    backdrop-filter:blur(20px);
    box-shadow:0 0 50px rgba(0,0,0,0.3);
}
.chat-header {
    background: linear-gradient(90deg,#064643,#198754);
    padding:20px 30px;
    display:flex;
    align-items:center;
}
.chat-title {
    font-size:24px;
    font-weight:600;
    display:flex;
    align-items:center;
    gap:12px;
    width:100%;
}
.status-indicator {
    width:10px;
    height:10px;
    border-radius:50%;
    background:#4ade80;
    animation:pulse 2s infinite;
}
@keyframes pulse {0%,100%{opacity:1;}50%{opacity:0.5;}}

.chat-messages {
    flex:1;
    overflow-y:auto;
    padding:30px;
    display:flex;
    flex-direction:column;
    gap:20px;
    scroll-behavior:smooth;
    position: relative;
}

.chat-messages::before {
    content: "";
    position: absolute;
    top:0; left:0;
    width:100%; height:100%;
    background-image: url('/static/Logo\ PCM_Prancheta\ 1\ c√≥pia.png');
    background-size: contain;
    background-position: center;
    background-repeat: no-repeat;
    opacity:0.1;
    z-index:0;
}

.chat-messages > * {position: relative; z-index:1;}

.chat-messages::-webkit-scrollbar{width:6px;}
.chat-messages::-webkit-scrollbar-track{background:rgba(255,255,255,0.05);border-radius:3px;}
.chat-messages::-webkit-scrollbar-thumb{background:rgba(25,135,84,0.5);border-radius:3px;}

.message {
    display:flex;
    margin-bottom:20px;
    animation:messageSlide 0.4s ease-out;
}
@keyframes messageSlide {
    from{opacity:0;transform:translateY(20px);}
    to{opacity:1;transform:translateY(0);}
}
.message.user{justify-content:flex-end;}

.message-content {
    max-width: 70%;
}

.message-bubble {
    padding: 14px 18px;
    border-radius: 18px;
    line-height: 1.5;
    word-wrap: break-word;
    white-space: pre-wrap;
}

.message.user .message-bubble {
    background: rgba(25, 135, 84, 0.8);
    color: white;
    border-bottom-right-radius: 4px;
    box-shadow: 0 4px 15px rgba(25,135,84,0.3);
}

.message.bot .message-bubble {
    background: rgba(255, 255, 255, 0.15);
    color: #e2e8f0;
    border:1px solid rgba(255,255,255,0.1);
    border-bottom-left-radius: 4px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
}

.message-avatar{
    width:40px;
    height:40px;
    border-radius:50%;
    margin:0 12px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:bold;
    font-size:20px;
    flex-shrink: 0;
}
.message.user .message-avatar{
    background:linear-gradient(135deg,#198754,#20c997);
    order:2;
}
.message.bot .message-avatar{
    background:linear-gradient(135deg,#6366f1,#8b5cf6);
}

.message-time{
    font-size:11px;
    opacity:0.6;
    margin-top:4px;
}

.chat-input{
    padding:25px 30px;
    border-top:1px solid rgba(255,255,255,0.1);
    background: rgba(6,70,67,0.3);
}

.input-container{
    display:flex;
    gap:15px;
    align-items:flex-end;
}

.input-wrapper{
    flex:1;
    position:relative;
}

#messageInput{
    width:100%;
    background:rgba(255,255,255,0.08);
    border:1px solid rgba(255,255,255,0.2);
    border-radius:22px;
    padding:14px 20px;
    color:white;
    font-size:16px;
    resize:none;
    min-height:44px;
    max-height:120px;
    transition:all 0.3s ease;
    backdrop-filter:blur(10px);
}

#messageInput:focus{
    outline:none;
    border-color:#198754;
    box-shadow:0 0 0 3px rgba(25,135,84,0.2);
    background:rgba(255,255,255,0.12);
}

#messageInput::placeholder{
    color:rgba(255,255,255,0.6);
}

#sendButton{
    background:linear-gradient(135deg,#198754,#20c997);
    border:none;
    width:50px;
    height:50px;
    border-radius:50%;
    cursor:pointer;
    display:flex;
    align-items:center;
    justify-content:center;
    transition:all 0.3s ease;
    box-shadow:0 4px 15px rgba(25,135,84,0.3);
    flex-shrink: 0;
}

#sendButton:hover:not(:disabled){
    transform:scale(1.05);
    box-shadow:0 6px 20px rgba(25,135,84,0.4);
}

#sendButton:disabled{
    opacity:0.5;
    cursor:not-allowed;
}

.send-icon{
    width:20px;
    height:20px;
    fill:white;
}

.typing-indicator{
    display:none;
    align-items:center;
    gap:12px;
}

.typing-indicator.show {
    display: flex;
}

.typing-dots{
    display:flex;
    gap:4px;
    padding: 12px 16px;
    background:rgba(255,255,255,0.08);
    border-radius:18px;
    border-bottom-left-radius:4px;
}

.typing-dot{
    width:8px;
    height:8px;
    border-radius:50%;
    background:#64748b;
    animation:typing 1.4s infinite;
}
.typing-dot:nth-child(2){animation-delay:0.2s;}
.typing-dot:nth-child(3){animation-delay:0.4s;}

@keyframes typing{
    0%,60%,100%{transform:translateY(0);opacity:0.4;}
    30%{transform:translateY(-10px);opacity:1;}
}
</style>
</head>
<body>
<div class="chat-container">
    <div class="chat-header">
        <div class="chat-title">
            <div class="status-indicator"></div>
            <span>Chat da Ferramentaria 4.0</span>
        </div>
    </div>

    <div class="chat-messages" id="chatMessages">
        <div class="message bot">
            <div class="message-avatar">ü§ñ</div>
            <div class="message-content">
                <div class="message-bubble">Ol√°! Bem-vindo ao Chat da Ferramentaria 4.0. Como posso ajud√°-lo?</div>
                <div class="message-time" id="botTime"></div>
            </div>
        </div>
    </div>

    <div class="chat-input">
        <div class="input-container">
            <div class="input-wrapper">
                <textarea id="messageInput" placeholder="Digite sua mensagem..." rows="1"></textarea>
            </div>
            <button id="sendButton" onclick="sendMessage()">
                <svg class="send-icon" viewBox="0 0 24 24">
                    <path d="M2,21L23,12L2,3V10L17,12L2,14V21Z"/>
                </svg>
            </button>
        </div>
    </div>
</div>

<script>
const chatMessages = document.getElementById('chatMessages');
const messageInput = document.getElementById('messageInput');
const sendButton = document.getElementById('sendButton');

// Auto-resize textarea
messageInput.addEventListener('input', function(){
    this.style.height = 'auto';
    this.style.height = Math.min(this.scrollHeight, 120) + 'px';
});

// Enter para enviar (Shift+Enter para nova linha)
messageInput.addEventListener('keydown', function(e){
    if(e.key === 'Enter' && !e.shiftKey){
        e.preventDefault();
        sendMessage();
    }
});

// Hora atual
function getCurrentTime(){
    return new Date().toLocaleTimeString('pt-BR', {hour:'2-digit', minute:'2-digit'});
}

// Define hora inicial
document.getElementById('botTime').textContent = getCurrentTime();

// Scroll autom√°tico
function scrollToBottom(){
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

// Adiciona mensagem do usu√°rio
function addUserMessage(message){
    const messageDiv = document.createElement('div');
    messageDiv.className = 'message user';
    messageDiv.innerHTML = `
        <div class="message-content">
            <div class="message-bubble">${escapeHtml(message)}</div>
            <div class="message-time">${getCurrentTime()}</div>
        </div>
        <div class="message-avatar">üë§</div>
    `;
    chatMessages.appendChild(messageDiv);
    scrollToBottom();
}

// Adiciona mensagem do bot
function addBotMessage(message){
    const messageDiv = document.createElement('div');
    messageDiv.className = 'message bot';
    messageDiv.innerHTML = `
        <div class="message-avatar">ü§ñ</div>
        <div class="message-content">
            <div class="message-bubble">${escapeHtml(message)}</div>
            <div class="message-time">${getCurrentTime()}</div>
        </div>
    `;
    chatMessages.appendChild(messageDiv);
    scrollToBottom();
}

// Escape HTML
function escapeHtml(text){
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

// Indicador de digita√ß√£o
function showTypingIndicator(){
    const indicator = document.createElement('div');
    indicator.className = 'message bot typing-indicator show';
    indicator.id = 'typingIndicator';
    indicator.innerHTML = `
        <div class="message-avatar">ü§ñ</div>
        <div class="typing-dots">
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
        </div>
    `;
    chatMessages.appendChild(indicator);
    scrollToBottom();
}

function hideTypingIndicator(){
    const indicator = document.getElementById('typingIndicator');
    if(indicator) indicator.remove();
}

// Envia mensagem
async function sendMessage(){
    const message = messageInput.value.trim();
    if(!message) return;
    
    // Adiciona mensagem do usu√°rio
    addUserMessage(message);
    
    // Limpa input
    messageInput.value = '';
    messageInput.style.height = 'auto';
    
    // Desabilita bot√£o
    sendButton.disabled = true;
    
    // Mostra indicador de digita√ß√£o
    showTypingIndicator();
    
    try {
        // Envia para a API
        const response = await fetch('/chat', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ message: message })
        });
        
        if (!response.ok) {
            throw new Error('Erro na resposta do servidor');
        }
        
        const data = await response.json();
        
        // Aguarda 800ms para parecer mais natural
        setTimeout(() => {
            hideTypingIndicator();
            addBotMessage(data.reply || 'Desculpe, n√£o consegui processar sua mensagem.');
            sendButton.disabled = false;
            messageInput.focus();
        }, 800);
        
    } catch (error) {
        console.error('Erro ao enviar mensagem:', error);
        setTimeout(() => {
            hideTypingIndicator();
            addBotMessage('Desculpe, ocorreu um erro. Tente novamente.');
            sendButton.disabled = false;
            messageInput.focus();
        }, 800);
    }
}

// Foca no input ao carregar
window.addEventListener('load', () => {
    messageInput.focus();
});
</script>
</body>
</html>